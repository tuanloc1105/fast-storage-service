<div class="h-full flex flex-col justify-between">
  <div class="flex flex-col gap-6">
    <div class="flex items-center justify-between">
      <span class="font-bold text-xl lg:text-lg md:text-base"
        >File Manager</span
      >
      <p-button
        label="New folder"
        icon="pi pi-folder-plus"
        [text]="true"
        size="small"
        (click)="newFolderVisible = true"
      ></p-button>
    </div>
    <p-tree
      styleClass="p-0"
      loadingMode="icon"
      [contextMenu]="cm"
      [value]="storageStore.directories()"
      selectionMode="single"
      [(selection)]="selectedDocumentFolder"
      (selectionChange)="onNodeSelect($event)"
      (onNodeContextMenuSelect)="onTreeContextMenuSelect($event)"
      (onNodeExpand)="onNodeExpand($event)"
    >
    </p-tree>
    <p-contextMenu #cm [model]="folderContextMenu" />
  </div>
  <div class="flex flex-col gap-3">
    <p-meterGroup [value]="meter()" labelPosition="start">
      <ng-template pTemplate="label" let-totalPercent="totalPercent">
        <div class="flex justify-between">
          <span class="md:text-sm">Storage usage</span>
          <span class="text-gray-500 md:text-sm"
            >{{ storageStore.status()?.used?.toFixed() }} MB /
            {{ storageStore.status()?.maximunSize }} MB</span
          >
        </div>
      </ng-template>
      <ng-template pTemplate="end">
        <div class="flex items-center justify-center">
          <p-button label="Upgrade your Storage" [text]="true" size="small" />
        </div>
      </ng-template>
    </p-meterGroup>
  </div>
</div>

<p-dialog
  header="Add new folder"
  [modal]="true"
  [(visible)]="newFolderVisible"
  [style]="{ width: '25rem' }"
  draggable="false"
>
  <div class="flex items-center gap-3 mb-3">
    <label for="folder" class="font-semibold w-6rem">Folder name</label>
    <input
      pInputText
      id="folder"
      class="flex-auto"
      autocomplete="off"
      [(ngModel)]="newFolderName"
    />
  </div>
  <div class="flex justify-end gap-2">
    <p-button
      label="Cancel"
      severity="secondary"
      (click)="closeNewFolderDialog()"
    />
    <p-button
      label="Save"
      (click)="addNewFolder()"
      [disabled]="!newFolderName"
      [loading]="storageStore.isLoading()"
    />
  </div>
</p-dialog>
